
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>A beginner’s guide to nftables &#8212; A beginner&#39;s guide to nftables 0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="a-beginner-s-guide-to-nftables">
<h1><a class="toc-backref" href="#id2">A beginner’s guide to nftables</a><a class="headerlink" href="#a-beginner-s-guide-to-nftables" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#a-beginner-s-guide-to-nftables" id="id2">A beginner’s guide to nftables</a><ul>
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a><ul>
<li><a class="reference internal" href="#why-this-guide" id="id4">Why this guide?</a></li>
<li><a class="reference internal" href="#what-is-a-packet-filter" id="id5">What is a packet filter?</a></li>
<li><a class="reference internal" href="#what-are-nftables-nf-tables-and-netfilter" id="id6">What are nftables, nf_tables and Netfilter?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-enable-or-reset-nftables-with-systemd" id="id7">How to enable or reset nftables with systemd</a></li>
<li><a class="reference internal" href="#simple-example" id="id8">Simple example</a></li>
<li><a class="reference internal" href="#basic-concepts" id="id9">Basic concepts</a><ul>
<li><a class="reference internal" href="#address-families" id="id10">Address families</a></li>
<li><a class="reference internal" href="#hooks" id="id11">Hooks</a></li>
<li><a class="reference internal" href="#tables-and-chains" id="id12">Tables and chains</a></li>
<li><a class="reference internal" href="#rules" id="id13">Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-basic-configuration" id="id14">Creating a basic configuration</a></li>
<li><a class="reference internal" href="#common-use-cases" id="id15">Common use cases</a><ul>
<li><a class="reference internal" href="#blocking-ports" id="id16">Blocking ports</a></li>
<li><a class="reference internal" href="#blocking-specific-content" id="id17">Blocking specific content</a></li>
<li><a class="reference internal" href="#allow-established-connections" id="id18">Allow established connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#list-of-common-commands" id="id19">List of common commands</a></li>
<li><a class="reference internal" href="#advanced-use-cases" id="id20">Advanced use cases</a><ul>
<li><a class="reference internal" href="#port-knocking" id="id21">Port knocking</a></li>
<li><a class="reference internal" href="#ddos-protection" id="id22">DDoS protection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgments" id="id23">Acknowledgments</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-this-guide">
<h3><a class="toc-backref" href="#id4">Why this guide?</a><a class="headerlink" href="#why-this-guide" title="Permalink to this headline">¶</a></h3>
<p>While there are a number of beginner’s guides for <a class="reference external" href="https://netfilter.org/projects/iptables/index.html">iptables</a> and <a class="reference external" href="https://netfilter.org">netfilter</a>, I could not find one that uses <code class="docutils literal notranslate"><span class="pre">nftables</span></code>. Every <code class="docutils literal notranslate"><span class="pre">nftables</span></code> tutorial I have found assumes familiarity with <code class="docutils literal notranslate"><span class="pre">iptables</span></code>. So if you want to teach students basic firewall concepts with Linux, you either have to accept that there are no introductory texts or start with <code class="docutils literal notranslate"><span class="pre">iptables</span></code> before moving on to <code class="docutils literal notranslate"><span class="pre">nftables</span></code>. This simple guide attempts to bridge this gap. In many ways this is simply a filtered collection of information from various manpages and other sources in a format that should be beginner friendly.</p>
<div class="topic">
<p class="topic-title">Disclaimer</p>
<p>I am in no way an expert on either nftables, Netfilter or any of the affiliated projects, so there is a chance that mistakes have crept in. If you find any mistakes, please let me know and I will fix them as soon as possible.</p>
</div>
<p>I would also like to point out that the <code class="docutils literal notranslate"><span class="pre">nft</span></code> <a class="reference external" href="https://www.netfilter.org/projects/nftables/manpage.html">manpage</a> is an excellent source of information, and much of the basic concepts presented here are more or less direct reproductions from it. If you are interested in more advanced use cases, I would recommend you start with the <a class="reference external" href="https://www.netfilter.org/projects/nftables/manpage.html">manpage</a>.</p>
<p>Since I borrow heavily from various sources, I have done my best to add appropriate attribution wherever possible.</p>
</div>
<div class="section" id="what-is-a-packet-filter">
<h3><a class="toc-backref" href="#id5">What is a packet filter?</a><a class="headerlink" href="#what-is-a-packet-filter" title="Permalink to this headline">¶</a></h3>
<p>A packet filter, colloquially also known as a firewall, allows an administrator to match network packets with a set of rules that specify how to handle matching packets. For instance you can drop packets, count and log packets, or allow a certain subset of packets.</p>
<p>A simple rule could be to block all traffic to TCP port 22 except for a specific IP address. Similarly, an administrator could block all outgoing packets to the network 10.0.0.0/8, or if the machine routes packets between networks A and B, the administrator could add a rule that allows all HTTP traffic from network A to B but blocks all other traffic from A to B.</p>
<p>The above are just some simple examples and Netfilter in particular has many more capabilities and features. We will demonstrate several more as we go along.</p>
</div>
<div class="section" id="what-are-nftables-nf-tables-and-netfilter">
<h3><a class="toc-backref" href="#id6">What are nftables, nf_tables and Netfilter?</a><a class="headerlink" href="#what-are-nftables-nf-tables-and-netfilter" title="Permalink to this headline">¶</a></h3>
<p>To quote from the <code class="docutils literal notranslate"><span class="pre">nft</span></code> manpage, “<em>nft is the command line tool used to set up, maintain and inspect packet filtering […] rules in the Linux kernel, in the nftables framework. The Linux kernel subsystem is known as nf_tables, and ‘nf’ stands for Netfilter.</em>”</p>
<p>Netfilter has been the kernel’s packet filtering subsystem since Linux 2.4.x, and for a long time <code class="docutils literal notranslate"><span class="pre">iptables</span></code>, <code class="docutils literal notranslate"><span class="pre">ip6tables</span></code>, <code class="docutils literal notranslate"><span class="pre">arptables</span></code> and <code class="docutils literal notranslate"><span class="pre">ebtables</span></code> have been the main user space utilities to administer the various packet filtering rules. However, their interfaces are less flexible than some people would like, and maintaining larger rulesets can be somewhat cumbersome. Therefore, <code class="docutils literal notranslate"><span class="pre">nftables</span></code> was developed and saw its first official release in Linux 3.13.</p>
<p><code class="docutils literal notranslate"><span class="pre">nft</span></code> has a completely different syntax than <code class="docutils literal notranslate"><span class="pre">iptables</span></code>, which might take some getting used to for people accustomed to <code class="docutils literal notranslate"><span class="pre">iptables</span></code>, but <code class="docutils literal notranslate"><span class="pre">nft</span></code> has some nice features that make it worth your while. For instance, <code class="docutils literal notranslate"><span class="pre">nft</span></code> can handle all use cases that previously required four separate tools (<code class="docutils literal notranslate"><span class="pre">iptables</span></code>, <code class="docutils literal notranslate"><span class="pre">ip6tables</span></code>, <code class="docutils literal notranslate"><span class="pre">arptables</span></code> and <code class="docutils literal notranslate"><span class="pre">ebtables</span></code>). So instead of having to write two separate rules for a content match in IPv4 and IPv6, <code class="docutils literal notranslate"><span class="pre">nft</span></code> can achieve the same match with a single rule.</p>
<p>For more examples why <code class="docutils literal notranslate"><span class="pre">nftables</span></code> makes your life easier, see: <a class="reference external" href="https://home.regit.org/2014/01/why-you-will-love-nftables/">Why you will love nftables</a></p>
<p>My main two complaints about <code class="docutils literal notranslate"><span class="pre">nftables</span></code> in its current state are (1) that the documentation is severely lacking (one of the reasons why I am writing this tutorial), and (2) that the online help of <code class="docutils literal notranslate"><span class="pre">nft</span></code> could be improved a lot, meaning the positional arguments to <code class="docutils literal notranslate"><span class="pre">nft</span></code> are not always obvious.</p>
</div>
</div>
<div class="section" id="how-to-enable-or-reset-nftables-with-systemd">
<h2><a class="toc-backref" href="#id7">How to enable or reset nftables with systemd</a><a class="headerlink" href="#how-to-enable-or-reset-nftables-with-systemd" title="Permalink to this headline">¶</a></h2>
<p>I am assuming that you already have nftables installed, otherwise install it with your method of choice.</p>
<p>Most GNU/Linux distributions use systemd as their init system now, so I will only cover systemd here. In all likelihood, nftables is already enabled, but if it is not, you can enable it as root with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nftables</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
<p>If you have changed the config file and want to reload the ruleset, you can run as root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">nftables</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-example">
<h2><a class="toc-backref" href="#id8">Simple example</a><a class="headerlink" href="#simple-example" title="Permalink to this headline">¶</a></h2>
<p>Before we get into the basic concepts, let us start with a simple example, just to give you an idea how <code class="docutils literal notranslate"><span class="pre">nftables</span></code> works.</p>
<p>Let us start by listing all existing rules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="nb">list</span> <span class="n">ruleset</span>
</pre></div>
</div>
<p>On a Debian-based system, this might be the output you are seeing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="n">inet</span> <span class="nb">filter</span> <span class="p">{</span>
      <span class="n">chain</span> <span class="nb">input</span> <span class="p">{</span>
              <span class="nb">type</span> <span class="nb">filter</span> <span class="n">hook</span> <span class="nb">input</span> <span class="n">priority</span> <span class="nb">filter</span><span class="p">;</span> <span class="n">policy</span> <span class="n">accept</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">chain</span> <span class="n">forward</span> <span class="p">{</span>
              <span class="nb">type</span> <span class="nb">filter</span> <span class="n">hook</span> <span class="n">forward</span> <span class="n">priority</span> <span class="nb">filter</span><span class="p">;</span> <span class="n">policy</span> <span class="n">accept</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">chain</span> <span class="n">output</span> <span class="p">{</span>
              <span class="nb">type</span> <span class="nb">filter</span> <span class="n">hook</span> <span class="n">output</span> <span class="n">priority</span> <span class="nb">filter</span><span class="p">;</span> <span class="n">policy</span> <span class="n">accept</span><span class="p">;</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We will discuss this output in detail later, for now note that you have a table called <code class="docutils literal notranslate"><span class="pre">filter</span></code> that uses a chain called <code class="docutils literal notranslate"><span class="pre">input</span></code>.</p>
<p>If you get no output, that means you have no default configuration set up, and you have to add the table and chain first, before you can do anything with it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">table</span> <span class="n">inet</span> <span class="nb">filter</span>
<span class="n">nft</span> <span class="n">add</span> <span class="n">chain</span> <span class="n">inet</span> <span class="nb">filter</span> <span class="nb">input</span> <span class="p">{</span> <span class="nb">type</span> <span class="nb">filter</span> <span class="n">hook</span> <span class="nb">input</span> <span class="n">priority</span> <span class="mi">0</span> \<span class="p">;</span> <span class="n">policy</span> <span class="n">accept</span>\<span class="p">;}</span>
</pre></div>
</div>
<p>Let us start by adding a rule to block all traffic to port 21 to the input chain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">rule</span> <span class="n">inet</span> <span class="nb">filter</span> <span class="nb">input</span> <span class="n">tcp</span> <span class="n">dport</span> <span class="mi">21</span> <span class="n">counter</span> <span class="n">drop</span>
</pre></div>
</div>
<p>If you are familiar with <code class="docutils literal notranslate"><span class="pre">iptables</span></code>, note that no interface has been specified, so this rule applies to every network interface on the system. I originally used port 22 here, but I did not want anyone to accidentally lose access to their server if by an off-chance they happened to try this on a remote server with only ssh access…</p>
<p>You could simply test that this rule works by opening a local socket on port 21 (assuming you have no ftp server running), and try to connect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># open a listening socket on port 21</span>
<span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="mi">21</span>
<span class="c1"># in a new terminal, try to connect to port 21 on localhost</span>
<span class="n">nc</span> <span class="n">localhost</span> <span class="mi">21</span>
</pre></div>
</div>
<p>If everything is set up correctly, the client will not be able to connect to the server, so anything you type on the client will not reach the server. If you are not familiar with <code class="docutils literal notranslate"><span class="pre">netcat</span></code>, you might want to try it without any firewall rules first to see what is supposed to happen.</p>
<p>This example was inspired by <a class="reference external" href="https://www.youtube.com/channel/UCFFLP0dKesrKWccYscdAr9A">theurbanpenguin</a> and <a class="reference external" href="https://www.youtube.com/channel/UC0A3ldncnGQ1M_RU2Wb4L2A">quidsup</a> on youtube, who each have a nice, short <code class="docutils literal notranslate"><span class="pre">nft</span></code> video tutorial:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.youtube.com/watch?v=Hpfcd7qZUis">RHCSA 8 - Native Nftables Firewalls on Red Hat Enterprise Linux 8</a></li>
<li><a class="reference external" href="https://www.youtube.com/watch?v=_A-Q6yTMX0g">Getting Started with nftables Firewall in Debian</a></li>
</ul>
</div>
<div class="section" id="basic-concepts">
<h2><a class="toc-backref" href="#id9">Basic concepts</a><a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="address-families">
<h3><a class="toc-backref" href="#id10">Address families</a><a class="headerlink" href="#address-families" title="Permalink to this headline">¶</a></h3>
<p>Nftables has support for six address families (reproduced from the <a class="reference external" href="https://www.netfilter.org/projects/nftables/manpage.html">manpage</a>):</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ip:</th><td class="field-body">IPv4 address family.</td>
</tr>
<tr class="field-even field"><th class="field-name">ip6:</th><td class="field-body">IPv6 address family.</td>
</tr>
<tr class="field-odd field"><th class="field-name">inet:</th><td class="field-body">Internet (IPv4/IPv6) address family.</td>
</tr>
<tr class="field-even field"><th class="field-name">arp:</th><td class="field-body">ARP address family, handling IPv4 ARP packets.</td>
</tr>
<tr class="field-odd field"><th class="field-name">bridge:</th><td class="field-body">Bridge address family, handling packets which traverse a bridge device (switch).</td>
</tr>
<tr class="field-even field"><th class="field-name">netdev:</th><td class="field-body">Netdev address family, handling packets from ingress.</td>
</tr>
</tbody>
</table>
<p>In this guide, we mostly focus on <cite>ip</cite> and <cite>inet</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For some commands, such as chain creation, the address family is optional, but if it is not explicitly specified the address family defaults to <strong>ip</strong>!</p>
</div>
</div>
<div class="section" id="hooks">
<h3><a class="toc-backref" href="#id11">Hooks</a><a class="headerlink" href="#hooks" title="Permalink to this headline">¶</a></h3>
<p>Hooks allow you to specify at which stage during the packet processing in the network stack you would like to match your rules. The different address families have different hooks, but in this guide we will focus only on IPv4/IPv6/Inet and Netdev.</p>
<div class="section" id="ipv4-ipv6-inet-hooks">
<h4>IPv4/IPv6/Inet Hooks<a class="headerlink" href="#ipv4-ipv6-inet-hooks" title="Permalink to this headline">¶</a></h4>
<p>There are five hooks you can use for the IPv4, IPv6 and inet address families:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Hook</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>prerouting</td>
<td>All packets entering the system are processed by the prerouting hook.
It is invoked before the routing process and is used for early filtering
or changing packet attributes that affect routing.</td>
</tr>
<tr class="row-odd"><td>input</td>
<td>Packets delivered to the local system are processed by the input hook.</td>
</tr>
<tr class="row-even"><td>forward</td>
<td>Packets forwarded to a different host are processed by the forward hook.</td>
</tr>
<tr class="row-odd"><td>output</td>
<td>Packets sent by local processes are processed by the output hook.</td>
</tr>
<tr class="row-even"><td>postrouting</td>
<td>All packets leaving the system are processed by the postrouting hook.</td>
</tr>
</tbody>
</table>
<p>On a regular workstation, you can cover the most common use cases with just the <cite>input</cite> and <cite>output</cite> hooks, and if you use VMs or containers potentially the <cite>forward</cite> hook.</p>
</div>
<div class="section" id="netdev-hooks">
<h4>Netdev Hooks<a class="headerlink" href="#netdev-hooks" title="Permalink to this headline">¶</a></h4>
<p>For the netdev address family, there is a single hook:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Hook</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ingress</td>
<td>All packets entering the system are processed by this hook. It is
invoked before layer 3 protocol handlers and it can be used for
early filtering and policing.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="tables-and-chains">
<h3><a class="toc-backref" href="#id12">Tables and chains</a><a class="headerlink" href="#tables-and-chains" title="Permalink to this headline">¶</a></h3>
<p>Tables are containers for chains, and chains are containers for rules, as you have seen in the <a class="reference internal" href="#simple-example">simple example</a>.</p>
<div class="section" id="tables">
<h4>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h4>
<p>Every table is identified by its name and its address family, so if you have the same table name for different address families, those are separate tables. Try for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">table</span> <span class="n">ip</span> <span class="n">foo</span>
<span class="n">nft</span> <span class="n">add</span> <span class="n">table</span> <span class="n">ip6</span> <span class="n">foo</span>
<span class="n">nft</span> <span class="n">add</span> <span class="n">table</span> <span class="n">arp</span> <span class="n">foo</span>
<span class="n">nft</span> <span class="nb">list</span> <span class="n">ruleset</span>
</pre></div>
</div>
<p>You should now have two new tables, one for IPv4 and one for ARP, both named <cite>foo</cite>.</p>
<p>You can also list all existing tables with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="nb">list</span> <span class="n">tables</span>
</pre></div>
</div>
<p>If you do not want the ARP table anymore, you can simply reverse the command with <cite>delete</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">delete</span> <span class="n">table</span> <span class="n">arp</span> <span class="n">foo</span>
</pre></div>
</div>
</div>
<div class="section" id="chains">
<h4>Chains<a class="headerlink" href="#chains" title="Permalink to this headline">¶</a></h4>
<p>There are two types of chains:</p>
<ol class="arabic simple">
<li><strong>base chains</strong>, which are hooked into the network stack using the <a class="reference internal" href="#hooks">hooks</a> described earlier, and</li>
<li><strong>regular chains</strong>, which can be used as jump targets from base chains, allowing for better rule organization.</li>
</ol>
<p>Every chain must belong to a table, so the minimum command to create a new chain looks as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">chain</span> <span class="n">foo</span> <span class="n">mychain</span>
</pre></div>
</div>
<p>We have now created a new chain called <cite>mychain</cite> in the table <cite>foo</cite>. But wait, if you followed along, you had two tables named <cite>foo</cite>, one for the address family <cite>ip</cite> and one for <cite>ip6</cite>! So which one was it added to? The attentive reader will remember that if no address family is specified, it defaults to <cite>ip</cite>. So the above command added <cite>mychain</cite> only to the <cite>ip foo</cite> table. You can easily verify this with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="nb">list</span> <span class="n">ruleset</span>
</pre></div>
</div>
<p>In order to avoid any confusion, it is probably best to always add the address family as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">chain</span> <span class="n">ip6</span> <span class="n">foo</span> <span class="n">mychain</span>
</pre></div>
</div>
<p>This successfully added <cite>mychain</cite> to the <cite>ip6 foo</cite> table.</p>
<p>You may have noted that we specified no hooks, so <cite>mychain</cite> is a <strong>regular chain</strong>, and is currently unused.</p>
<p>In order to create a <strong>base chain</strong> that hooks into the network stack, you have to add the desired <strong>hook</strong>, a specific <strong>type</strong> and a desired <strong>priority</strong>. We already covered <a class="reference internal" href="#hooks">hooks</a>. The <strong>type</strong> can be one of <cite>filter</cite>, <cite>nat</cite> and <cite>route</cite>. For our purposes in this beginner’s guide, the type will always be <cite>filter</cite>. Finally, as the name suggests, <strong>priorities</strong> allow you to specify a priority to determine in which order the chains are traversed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since this is a beginner’s guide, I will not elaborate any further on types and priorities, but the interested reader is pointed to the <a class="reference external" href="https://www.netfilter.org/projects/nftables/manpage.html">manpage</a>, and for additional background reading to the excellent <a class="reference external" href="https://rlworkman.net/howtos/iptables/chunkyhtml/index.html">iptables tutorial</a>, specifically <a class="reference external" href="https://rlworkman.net/howtos/iptables/chunkyhtml/c962.html">Chapter 6 Traversing tables and chains</a>. Just note that the iptables tutorial is outdated, I would not recommend to read it as standalone documentation, make sure to crossreference it with the information in the <code class="docutils literal notranslate"><span class="pre">nft</span></code> <a class="reference external" href="https://www.netfilter.org/projects/nftables/manpage.html">manpage</a>.</p>
</div>
<p>In the <a class="reference internal" href="#simple-example">simple example</a> you already saw how to create a base chain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nft</span> <span class="n">add</span> <span class="n">chain</span> <span class="n">inet</span> <span class="nb">filter</span> <span class="n">myoutputchain</span> <span class="p">{</span> <span class="nb">type</span> <span class="nb">filter</span> <span class="n">hook</span> <span class="n">output</span> <span class="n">priority</span> <span class="mi">0</span> \<span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This adds a new chain to the table <cite>inet filter</cite>, hooking onto the output hook. In other words, all IP packets that are created on your system and are about to be sent out will traverse this chain.</p>
</div>
</div>
<div class="section" id="rules">
<h3><a class="toc-backref" href="#id13">Rules</a><a class="headerlink" href="#rules" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
<div class="section" id="creating-a-basic-configuration">
<h2><a class="toc-backref" href="#id14">Creating a basic configuration</a><a class="headerlink" href="#creating-a-basic-configuration" title="Permalink to this headline">¶</a></h2>
<p>There are two main ways of using <code class="docutils literal notranslate"><span class="pre">nft</span></code> to configure your firewall:</p>
<ol class="arabic simple">
<li>Using the CLI tool <code class="docutils literal notranslate"><span class="pre">nft</span></code> (or its interactive mode <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-i</span></code>) to create tables, chains and rules as you go along.</li>
<li>Using a configuration file that you input to <code class="docutils literal notranslate"><span class="pre">nft</span> <span class="pre">-f</span></code> (default config typcially at <code class="docutils literal notranslate"><span class="pre">/etc/nftables.conf</span></code> or <code class="docutils literal notranslate"><span class="pre">/etc/sysconfig/nftables.conf</span></code>) (TODO: look up upstream location).</li>
</ol>
<p>Obviously you can write a basic configuration file, and make dynamic changes with <code class="docutils literal notranslate"><span class="pre">nft</span></code> as you see fit.</p>
</div>
<div class="section" id="common-use-cases">
<h2><a class="toc-backref" href="#id15">Common use cases</a><a class="headerlink" href="#common-use-cases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="blocking-ports">
<h3><a class="toc-backref" href="#id16">Blocking ports</a><a class="headerlink" href="#blocking-ports" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="blocking-specific-content">
<h3><a class="toc-backref" href="#id17">Blocking specific content</a><a class="headerlink" href="#blocking-specific-content" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="allow-established-connections">
<h3><a class="toc-backref" href="#id18">Allow established connections</a><a class="headerlink" href="#allow-established-connections" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
<div class="section" id="list-of-common-commands">
<h2><a class="toc-backref" href="#id19">List of common commands</a><a class="headerlink" href="#list-of-common-commands" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># list all rules</span>
nft list ruleset

<span class="c1"># list all IPv4 rules</span>
nft list ruleset ip

<span class="c1"># remove (flush) all rules</span>
nft flush ruleset

<span class="c1"># remove (flush) IPv$ rules</span>
nft flush ruleset ip
</pre></div>
</div>
</div>
<div class="section" id="advanced-use-cases">
<h2><a class="toc-backref" href="#id20">Advanced use cases</a><a class="headerlink" href="#advanced-use-cases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="port-knocking">
<h3><a class="toc-backref" href="#id21">Port knocking</a><a class="headerlink" href="#port-knocking" title="Permalink to this headline">¶</a></h3>
<p>TODO: basic description of port knocking.</p>
<p>TODO: port knocking example.</p>
</div>
<div class="section" id="ddos-protection">
<h3><a class="toc-backref" href="#id22">DDoS protection</a><a class="headerlink" href="#ddos-protection" title="Permalink to this headline">¶</a></h3>
<p>It is difficult to protect against DDoS attacks, but <code class="docutils literal notranslate"><span class="pre">nftables</span></code> allows you to filter packets as soon as they arrive to avoid using unnecessary resources, thus giving you a little bit more breathing room. You can use the address family <code class="docutils literal notranslate"><span class="pre">netdev</span></code> for this. <code class="docutils literal notranslate"><span class="pre">netdev</span></code> includes all traffic directed at your network interface, just after it was passed to the network stack and before any protocol parsing. See also the <a class="reference external" href="https://wiki.nftables.org/wiki-nftables/index.php/Nftables_families#netdev">nftables Wiki</a>.</p>
<p>TODO: example rules here.</p>
</div>
</div>
<div class="section" id="acknowledgments">
<h2><a class="toc-backref" href="#id23">Acknowledgments</a><a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<p>A special thanks to the <a class="reference external" href="http://www.kernel.org/">Linux kernel community</a>, as well as the <a class="reference external" href="https://netfilter.org">netfilter</a> and <a class="reference external" href="https://netfilter.org/projects/nftables/index.html">nftables</a> communities, for their much appreciated work! I am also grateful for the people around <a class="reference external" href="https://www.sphinx-doc.org">Sphinx</a> for having written a great documentation generator.</p>
<p>Many innovations we see today would not be possible without open source software in general, not to mention the important role it plays for democratic societies. Computing would be very dull without it!</p>
<p>Therefore, I would also like to thank everyone involved in the open source ecosystem in general <a class="footnote-reference" href="#f1" id="id1">[1]</a>: please keep up the good work! :)</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>If I were to list all the free and open source software I use daily we would still sit here tomorrow. However, I cannot resist listing a few projects and communities especially dear to my heart: <a class="reference external" href="https://www.debian.org/">Debian</a>, <a class="reference external" href="https://www.gnu.org/software/emacs/">Emacs</a>, <a class="reference external" href="https://www.gnu.org/">GNU</a>, <a class="reference external" href="https://www.kernel.org/">Linux</a>, <a class="reference external" href="http://www.python.org/">Python</a>, <a class="reference external" href="https://www.latex-project.org/">LaTeX</a>, <a class="reference external" href="https://i3wm.org/">i3</a> and <a class="reference external" href="https://www.mozilla.org/">Mozilla</a>. :)</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">A beginner's guide to nftables</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Aljoscha Lautenbach.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>